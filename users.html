<!DOCTYPE html>
<html>
<head>
<title>Registered Users</title>

<style>
body{
  font-family: Arial;
  background:#f4f4f4;
  padding:20px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}

h2{margin:0;}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}

th,td{
  border:1px solid #000;
  padding:10px;
  text-align:center;
}

th{background:#d9ead3;}

button{
  padding:6px 12px;
  border:none;
  cursor:pointer;
  border-radius:4px;
  color:#fff;
  margin-left:5px;
}

.view-btn{background:#007bff;}
.delete-btn{background:#dc3545;}
.delete-all{background:red;}
.restore-all{background:#16a34a;}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <h2>Registered Users</h2>

  <div>
    <button class="restore-all" onclick="restoreAllUsers()">
      Restore All
    </button>
    <button class="delete-all" onclick="deleteAllUsers()">
      Delete All
    </button>
  </div>
</div>

<table>
<thead>
<tr>
  <th>Customer Name</th>
  <th>Mobile</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="userList"></tbody>
</table>

<script>
/* ðŸ” ADMIN PASSWORD */
const ADMIN_PASSWORD = "admin123";

/* LOAD USER INDEX */
let user_index = JSON.parse(localStorage.getItem("user_index") || "[]");

/* RENDER USERS (ONLY NOT DELETED) */
function renderUsers(){
  let rows = "";

  user_index.forEach(userId => {
    let user = JSON.parse(localStorage.getItem(userId));

    if(user && !user.isDeleted){
      rows += `
        <tr>
          <td>${user.customerName}</td>
          <td>${user.mobile}</td>
          <td>
            <button class="view-btn" onclick="viewUser('${userId}')">
              View
            </button>
            <button class="delete-btn" onclick="deleteUser('${userId}')">
              Delete
            </button>
          </td>
        </tr>
      `;
    }
  });

  document.getElementById("userList").innerHTML =
    rows || `<tr><td colspan="3">No active users</td></tr>`;
}

/* VIEW USER */
function viewUser(userId){
  window.open("result.html?userId=" + userId, "_blank");
}

/* SOFT DELETE SINGLE USER */
function deleteUser(userId){
  const pass = prompt("Enter admin password:");
  if(pass !== ADMIN_PASSWORD){
    alert("Wrong password!");
    return;
  }

  if(!confirm("Delete this user? (Can be restored later)")) return;

  let user = JSON.parse(localStorage.getItem(userId));
  if(!user) return;

  user.isDeleted = true;
  localStorage.setItem(userId, JSON.stringify(user));

  renderUsers();
}

/* SOFT DELETE ALL USERS */
function deleteAllUsers(){
  const pass = prompt("Enter admin password:");
  if(pass !== ADMIN_PASSWORD){
    alert("Wrong password!");
    return;
  }

  if(!confirm("Delete ALL users? (Can be restored later)")) return;

  user_index.forEach(userId=>{
    let user = JSON.parse(localStorage.getItem(userId));
    if(user){
      user.isDeleted = true;
      localStorage.setItem(userId, JSON.stringify(user));
    }
  });

  renderUsers();
}

/* RESTORE ALL USERS */
function restoreAllUsers(){
  const pass = prompt("Enter admin password:");
  if(pass !== ADMIN_PASSWORD){
    alert("Wrong password!");
    return;
  }

  if(!confirm("Restore ALL deleted users?")) return;

  user_index.forEach(userId=>{
    let user = JSON.parse(localStorage.getItem(userId));
    if(user){
      user.isDeleted = false;
      localStorage.setItem(userId, JSON.stringify(user));
    }
  });

  alert("All users restored successfully!");
  renderUsers();
}

/* INIT */
renderUsers();
</script>

</body>
</html>
